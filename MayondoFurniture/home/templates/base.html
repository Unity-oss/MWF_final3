<!--
MAYONDO FURNITURE MANAGEMENT SYSTEM - BASE TEMPLATE
===================================================

This is the main template that all other pages extend from.
It provides:
- Common HTML structure and meta tags
- Navigation header with dropdown menus
- Tailwind CSS styling framework
- FontAwesome icons
- JavaScript for interactive features

The template uses Django's template inheritance system where other templates
can extend this base and override specific blocks.
-->

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block description %}MWF - Mayondo Wood & Furniture Management System{% endblock %}">
    <meta name="author" content="Mayondo Wood & Furniture">
    <title>{% block title %}MWF - Mayondo Wood & Furniture{% endblock %}</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'logo2.png' %}">
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Custom Tailwind configuration for Mayondo brand colors
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "cordes-blue": "#005f66",    // Primary brand color
              "cordes-dark": "#007b83",    // Secondary brand color
            },
          },
        },
      };
    </script>
    
    <!-- Additional head content from child templates -->
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen flex flex-col{% if user.is_authenticated %} authenticated{% endif %}">
 <!-- Main Header with Navigation -->
 <header class="bg-cordes-dark text-white px-6 py-4 flex justify-between items-center flex-wrap">
  <!-- Company Logo and Branding -->
  <div class="logo">
    <h1 class="text-xl font-bold">MWF System</h1>
  </div>

  <!-- Main Navigation Menu with Dropdowns -->
  <nav role="navigation" aria-label="Main navigation">
    <ul class="flex space-x-6 list-none m-0 p-0">
      <li><a href="/dashboard/" class="px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">Dashboard</a></li>
      
      <!-- Stock Dropdown -->
      <li class="relative">
        <button onclick="toggleHeaderDropdown('header-stock-dropdown')" class="flex items-center px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">
          Stock
          <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" id="header-stock-dropdown-icon"></i>
        </button>
        <div id="header-stock-dropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-white shadow-lg rounded-lg border border-gray-200 z-50">
          <a href="/addStock/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-plus mr-2 text-xs"></i>Add Stock
          </a>
          <a href="/stockRecord/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-list mr-2 text-xs"></i>All Stock
          </a>
          {% if is_manager %}
          <div class="border-t border-gray-200 my-1"></div>
          <a href="/stockReport/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-chart-pie mr-2 text-xs"></i>Stock Report
          </a>
          {% endif %}
        </div>
      </li>
      
      <!-- Sales Dropdown -->
      <li class="relative">
        <button onclick="toggleHeaderDropdown('header-sales-dropdown')" class="flex items-center px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">
          Sales
          <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" id="header-sales-dropdown-icon"></i>
        </button>
        <div id="header-sales-dropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-white shadow-lg rounded-lg border border-gray-200 z-50">
          <a href="/addSale/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-plus mr-2 text-xs"></i>Add Sale
          </a>
          <a href="/saleRecord/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-list mr-2 text-xs"></i>All Sales
          </a>
          {% if is_manager %}
          <div class="border-t border-gray-200 my-1"></div>
          <a href="/saleReport/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-chart-line mr-2 text-xs"></i>Sales Report
          </a>
          {% endif %}
        </div>
      </li>
      
      <!-- Customers Dropdown -->
      <li class="relative">
        <button onclick="toggleHeaderDropdown('header-customers-dropdown')" class="flex items-center px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">
          Customers
          <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" id="header-customers-dropdown-icon"></i>
        </button>
        <div id="header-customers-dropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-white shadow-lg rounded-lg border border-gray-200 z-50">
          <a href="/addCustomer/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-user-plus mr-2 text-xs"></i>Add Customer
          </a>
          <a href="/customerList/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-users mr-2 text-xs"></i>All Customers
          </a>
        </div>
      </li>
      
      <!-- Suppliers Dropdown -->
      <li class="relative">
        <button onclick="toggleHeaderDropdown('header-suppliers-dropdown')" class="flex items-center px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">
          Suppliers
          <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" id="header-suppliers-dropdown-icon"></i>
        </button>
        <div id="header-suppliers-dropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-white shadow-lg rounded-lg border border-gray-200 z-50">
          <a href="/addSupplier/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-truck mr-2 text-xs"></i>Add Supplier
          </a>
          <a href="/supplierList/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-industry mr-2 text-xs"></i>All Suppliers
          </a>
        </div>
      </li>
      
      <!-- Reports Dropdown - Only visible to Managers -->
      {% if is_manager %}
      <li class="relative">
        <button onclick="toggleHeaderDropdown('header-reports-dropdown')" class="flex items-center px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">
          Reports
          <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" id="header-reports-dropdown-icon"></i>
        </button>
        <div id="header-reports-dropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-white shadow-lg rounded-lg border border-gray-200 z-50">
          <a href="/report/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-file-alt mr-2 text-xs"></i>Generate Report
          </a>
          <a href="/saleReport/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-chart-line mr-2 text-xs"></i>Sales Report
          </a>
          <a href="/stockReport/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors text-sm no-underline">
            <i class="fas fa-chart-pie mr-2 text-xs"></i>Stock Report
          </a>
        </div>
      </li>
      {% endif %}
      
      <li><a href="/logout/" class="px-3 py-2 rounded-md font-medium hover:bg-cordes-blue transition-colors duration-300 no-underline text-white">Logout</a></li>
    </ul>
  </nav>
</header>

<!-- Skip Link for Accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-cordes-dark text-white px-4 py-2 rounded z-50">Skip to main content</a>

<!-- Django Messages Display (excluding welcome messages) -->
{% if messages %}
<div class="max-w-7xl mx-auto px-6 pt-4">
    {% for message in messages %}
        {% if 'Welcome back' not in message.message %}
        <div class="mb-4 px-4 py-3 rounded-lg border-l-4 shadow-md {% if message.tags == 'error' %}bg-red-50 border-red-400 text-red-700{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-400 text-yellow-700{% elif message.tags == 'success' %}bg-green-50 border-green-400 text-green-700{% else %}bg-blue-50 border-blue-400 text-blue-700{% endif %} flex items-start">
            <div class="flex-shrink-0 mr-3 mt-0.5">
                {% if message.tags == 'error' %}
                    <i class="fas fa-exclamation-triangle"></i>
                {% elif message.tags == 'warning' %}
                    <i class="fas fa-exclamation-circle"></i>
                {% elif message.tags == 'success' %}
                    <i class="fas fa-check-circle"></i>
                {% else %}
                    <i class="fas fa-info-circle"></i>
                {% endif %}
            </div>
            <div class="flex-1">
                <p class="font-medium text-sm mb-1">
                    {% if message.tags == 'error' %}Error
                    {% elif message.tags == 'warning' %}Warning
                    {% elif message.tags == 'success' %}Success
                    {% else %}Info
                    {% endif %}
                </p>
                <p class="text-sm">{{ message }}</p>
            </div>
            <button type="button" class="flex-shrink-0 ml-3 text-gray-400 hover:text-gray-600" onclick="this.parentElement.style.display='none';">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

<main id="main-content" class="flex-1 max-w-7xl mx-auto p-6 w-full" role="main">
    {% block content %}{% endblock %}
</main>

<footer class="bg-cordes-dark text-white text-center py-4 mt-auto" role="contentinfo">
    <p class="m-0">&copy; Copyright 2025 - Mayondo Wood & Furniture. All rights reserved.</p>
    <p class="text-sm text-gray-300 mt-1">Designed by Unity</p>
</footer>

{% block extra_js %}{% endblock %}

<script>
function toggleHeaderDropdown(dropdownId) {
  const dropdown = document.getElementById(dropdownId);
  const icon = document.getElementById(dropdownId + '-icon');
  
  // Close all other header dropdowns first
  const allHeaderDropdowns = document.querySelectorAll('[id^="header-"][id$="-dropdown"]');
  const allHeaderIcons = document.querySelectorAll('[id^="header-"][id$="-dropdown-icon"]');
  
  allHeaderDropdowns.forEach((dd) => {
    if (dd.id !== dropdownId) {
      dd.classList.add('hidden');
    }
  });
  
  allHeaderIcons.forEach((ic) => {
    if (ic.id !== dropdownId + '-icon') {
      ic.classList.remove('rotate-180');
    }
  });
  
  // Toggle current dropdown
  if (dropdown.classList.contains('hidden')) {
    dropdown.classList.remove('hidden');
    icon.classList.add('rotate-180');
  } else {
    dropdown.classList.add('hidden');
    icon.classList.remove('rotate-180');
  }
}

// Close header dropdowns when clicking outside
document.addEventListener('click', function(e) {
  const isHeaderDropdownButton = e.target.closest('[onclick*="toggleHeaderDropdown"]');
  const isHeaderDropdownContent = e.target.closest('[id^="header-"][id$="-dropdown"]');
  
  if (!isHeaderDropdownButton && !isHeaderDropdownContent) {
    const allHeaderDropdowns = document.querySelectorAll('[id^="header-"][id$="-dropdown"]');
    const allHeaderIcons = document.querySelectorAll('[id^="header-"][id$="-dropdown-icon"]');
    
    allHeaderDropdowns.forEach((dropdown) => {
      dropdown.classList.add('hidden');
    });
    
    allHeaderIcons.forEach((icon) => {
      icon.classList.remove('rotate-180');
    });
  }
});

// Security: Prevent back button access after logout (authenticated users only)
if (document.body.classList.contains('authenticated')) {
    (function() {
        // Disable browser caching for authenticated pages
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || window.performance && window.performance.navigation.type === 2) {
                // Force page reload if accessed via back button
                window.location.reload();
            }
        });

        // Clear history on logout
        function clearBrowserHistory() {
            if (typeof(history.pushState) !== "undefined") {
                history.pushState(null, null, window.location.href);
                window.addEventListener('popstate', function() {
                    history.pushState(null, null, window.location.href);
                });
            }
        }
        
        // Apply history clearing
        clearBrowserHistory();
        
        // Monitor for logout and clear sensitive data
        window.addEventListener('beforeunload', function() {
            // Clear any sensitive data from memory
            if (window.performance && window.performance.clearResourceTimings) {
                window.performance.clearResourceTimings();
            }
        });
    })();
}

// Auto-hide messages after 8 seconds
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.mb-4.px-4.py-3.rounded-lg');
    messages.forEach(function(message) {
        setTimeout(function() {
            if (message.style.display !== 'none') {
                message.style.opacity = '0';
                message.style.transition = 'opacity 0.5s';
                setTimeout(function() {
                    message.style.display = 'none';
                }, 500);
            }
        }, 8000);
    });
});

// Global security headers check
if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    console.warn('⚠️ Security Warning: This application should be served over HTTPS in production.');
}
</script>

</body>
</html>